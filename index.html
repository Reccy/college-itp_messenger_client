<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Security-Policy">
		<title>Tinglr Messenger</title>

		<!-- OnsenUI plugin -->
		<link rel="stylesheet" href="bower_components/OnsenUI/css/onsenui.css"/>
	    <link rel="stylesheet" href="bower_components/OnsenUI/css/onsen-css-components-custom.css">
	    <script src="bower_components/angular/angular.js"></script>
	    <script src="bower_components/OnsenUI/js/onsenui.js"></script>

		<!-- Javascript plugins for client -->
		<script src="js/pubnub-3.10.3.min.js"></script>
		<script src="js/jquery-2.2.0.min.js"></script>
		<script src="phonegap.js"></script>
		<script src="js/server.js"></script>
	    <script>
			var module = ons.bootstrap('my-app', ['onsen']);
			module.controller('AppController', function($scope) {});
    	    module.controller('PageController', function($scope, $timeout) {
                ons.ready(function() {});
                
                $scope.login = function(loginUsername, loginPassword){
                    loginFailed = false;
                    illegals = /^[0-9a-zA-Z]+$/;
                    
                    console.log("ATTEMPTING LOGIN...");
                    
                    //Blank username check
                    if(loginUsername == undefined)
                    {
                        login_failed_username_blank_modal.show();
                        loginFailed = true;
                    }
                    
                    //Blank password check
                    if(loginPassword == undefined && !loginFailed)
                    {
                        login_failed_password_blank_modal.show();
                        loginFailed = true;
                    }
                    
                    //Illegal character check
                    if((!illegals.test(loginUsername) || !illegals.test(loginPassword)) && !loginFailed)
                    {
                        login_failed_illegals_modal.show();
                        loginFailed = true;
                    }
                    
                    //Send login request if other checks passed
                    if(!loginFailed){
                        login_attempt_modal.show();
                        
                        pubnub.publish({
                        channel: private_chan,
                            message: {
                                "m_type": "user_login",
                                "uuid": client_uuid,
                                "username": loginUsername,
                                "password": loginPassword
                            },
                            callback: function(m){
                                if (m[0] == "1")
                                {
                                    console.log("MESSAGE SENT SUCCESSFULLY: " + m);
                                }
                                else
                                {
                                    console.log("MESSAGE SENT FAILED: " + m);
                                }
                            }
                        });
                    }
                }
                
                $scope.register = function(registerUsername, registerPasswordOne, registerPasswordTwo){
                    registerFailed = false;
                    illegals = /^[0-9a-zA-Z]+$/;
                    
                    console.log("ATTEMPTING REGISTRATION...");
                    
                    //Blank username check
                    if(registerUsername == undefined)
                    {
                        register_failed_username_blank_modal.show();
                        registerFailed = true;
                    }
                    //Short username check
                    else if(registerUsername.length < 4 && !registerFailed)
                    {
                        register_failed_username_length_modal.show();
                        registerFailed = true;
                    }
                    
                    //Blank password check
                    if(registerPasswordOne == undefined && !registerFailed)
                    {
                        register_failed_password_blank_modal.show();
                        registerFailed = true;
                    }
                    //Short password check
                    else if(registerPasswordOne.length < 6 && !registerFailed)
                    {
                        register_failed_password_length_modal.show();
                        registerFailed = true;
                    }
                    
                    //Mismatched password check
                    if(registerPasswordOne != registerPasswordTwo && !registerFailed){
                        register_failed_password_miss_modal.show();
                        registerFailed = true;
                    }
                    
                    //Illegal character check
                    if((!illegals.test(registerUsername) || !illegals.test(registerPasswordOne)) && !registerFailed)
                    {
                        register_failed_illegals_modal.show();
                        registerFailed = true;
                    }
                    
                    //If the user's input is verified, continue with the registration attempt
                    if(!registerFailed)
                    {
                        register_attempt_modal.show();
                        
                        pubnub.publish({
                            channel: private_chan,
                            message: {
                                "m_type": "user_register",
                                "uuid": client_uuid,
                                "username": registerUsername,
                                "password": registerPasswordOne
                            },
                            callback: function(m){
                                if (m[0] == "1")
                                {
                                    console.log("MESSAGE SENT SUCCESSFULLY: " + m);
                                }
                                else
                                {
                                    console.log("MESSAGE SENT FAILED: " + m);
                                }
                            }
                        });
                    }
                }
                
                //Sends the message to the other user
                $scope.send = function(msg){
                    if(/\S/.test(msg)) //Checks message to make sure it contains alphanumeric characters
                    {
                        sendMessage(msg, selectedEmotionName);
                        $scope.inputMSG = '';
                    }
                }
                
                //Reconnects to the server after a disconnect
                $scope.reconnect = function(){
                    console.log("Reconnecting...");
                    initialize_app();
                }
                
                //Searched for other users in the userlist - search.html
                $scope.searchOtherUsers = function(query){
                    query = query.toLowerCase();
                    
                    filteredList = [];
                    
                    if(/\S/.test(query)) //Checks query to make sure it contains alphanumeric characters
                    {
                        //Adds filtered people to the list
                        for(i = 0; i < userlist.length; i++){
                            if(userlist[i].toLowerCase().search(query) !== -1){
                                if(userlist[i] !== client_username){
                                    isAlreadyFriend = false;
                                    for(j = 0; j < channellist.length; j++)
                                    {
                                        if(userlist[i] === channellist[j].username)
                                        {
                                            isAlreadyFriend = true;
                                            break;
                                        }
                                    }
                                    if(!isAlreadyFriend)
                                    {
                                        filteredList.push(userlist[i]);        
                                    }
                                }
                            }
                        }
                        
                        
                        
                        $("#search_list").html("");
                        if(filteredList.length > 0)
                        {
                            for(i = 0; i < filteredList.length; i++){
                                $("#search_list").html($("#search_list").html() + "<ons-list-item class='list__item ons-list-item-inner list__item--chevron' modifier='chevron' onclick='promptConnectOther($(this).html());'>" + filteredList[i] + "</ons-list-item>");
                            }
                        }
                        else
                        {
                            //No results found
                            $("#search_list").html("<ons-list-item class='list__item ons-list-item-inner'>No Results</ons-list-item>");
                        }
                    }
                    else
                    {
                        $("#search_list").html("<ons-list-item class='list__item ons-list-item-inner'>No Results</ons-list-item>");
                    }
                }
                
                $scope.populateMain = function(){
                    console.log("Populate Main! -- AngularJS");
                    var arbitraryTimeoutBecauseAngularJSIsAwefulAndIHateItAndApparantlyOneMillisecondFixesThisBug = $timeout(function() {
                        console.log("JSON LENGTH: " + Object.keys(channellist).length);
                        if(Object.keys(channellist).length > 0){
                            $("#connected_user_list").html("");
                            for(i = 0; i < Object.keys(channellist).length; i++){
                                $("#connected_user_list").html($("#connected_user_list").html() + "<ons-list-item class='list__item ons-list-item-inner list__item--chevron' modifier='chevron' onclick='openChat($(this).html())'>" + channellist[i].username + "</ons-list-item>");
                            }
                        } else {
                            $("#connected_user_list").html("<ons-list-item class='list__item ons-list-item-inner'>You Have No Friends</ons-list-item>");
                        }
                    }, 1)
                }
            });
            
            function populateMainJS(){
                console.log("Populate Main! -- JavaScript");
                console.log("JSON LENGTH: " + Object.keys(channellist).length);
                if(Object.keys(channellist).length > 0){
                    $("#connected_user_list").html("");
                    for(i = 0; i < Object.keys(channellist).length; i++){
                        $("#connected_user_list").html($("#connected_user_list").html() + "<ons-list-item class='list__item ons-list-item-inner list__item--chevron' modifier='chevron' onclick='openChat($(this).html())'>" + channellist[i].username + "</ons-list-item>");
                    }
                } else {
                    $("#connected_user_list").html("<ons-list-item class='list__item ons-list-item-inner'>You Have No Friends</ons-list-item>");
                }
            }
            
            function openChat(user)
            {
                chatLoaded = false;
                currentConversation = user;
                console.log("OPENING CHAT WITH: " + user);
                tinglrNav.pushPage('conversation.html', {animation : 'lift'})
                tinglrNav.on("postpush", function(){
                    $("#other_username").html(user);
                    
                    for(i = 0; i < Object.keys(channellist).length; i++){
                        if(currentConversation === channellist[i].username){
                            currentChannel = channellist[i].channel;
                        }
                    }
                    
                    pubnub.history({
                        channel: currentChannel,
                        callback: function(m){
                            for(i = 0; i < m[0].length; i++)
                            {
                                if(m[0][i].text != null)
                                {
                                    displayMessage(m[0][i].sender, m[0][i].text, m[0][i].emotion);    
                                }
                            }
                            chatLoaded = true;
                            $("#chatList > .ons-scroller__content").scrollTop($("#chatList > .ons-scroller__content")[0].scrollHeight);
                        },
                        count: 50,
                        reverse: false
                    });
                    
                    //Remove event handler to prevent memory leak
                    tinglrNav.off("postpush", function(){
                        console.log("Removed Handler");
                    })
                });
            }
            
	      	function logoutPrompt(){
	      	    menu.closeMenu();
	      	    ons.notification.confirm({
                    title: 'Logout',
                    message: 'Are you sure you want to logout?',
                    callback: function(result) {
                        if(result === 1)
                        {
                            logout();
                        }
                    }
                });
	        }
	        
	        function logout(){
	            tinglrNav.resetToPage('landingscreen.html', {animation : 'fade'});
                client_username = null;
                loggedIn = false;
                channellist = [];
                pubnub.publish({
                    channel: private_chan,
                    message: {
                        uuid: client_uuid,
                        m_type: "user_logout"
                    },
                    callback: function() {
                        console.log("Logged out.");
                    }
                });
	        }
	        
	        function displayMessage(sender, msg, emotion){
	            //Escape the HTML
	            msg = escapeHtml(msg);
	            div = document.getElementById("Layer_1");
			        if (div.style.display == 'none') {
			        div.style.display = '';
			        }
	            
	            messageString = null; //The message string to be appended
	            
	            //Determine who sent the message
	            if(sender === client_username){
	                //User's message, display on the right
	                //console.log("R|| " + sender + ": " + msg + " || Emotion: " + emotion);
	                messageString = "<div class='msgBoxRight";
	                
	                //$("#chatList > div").append("<div class='msgBoxRight'><p>" + msg + "</p></div>");
	            }
	            else{
	                //Sender's message, display on the left
	                //console.log("L|| " + sender + ": " + msg + " || Emotion: " + emotion);
	                
	                messageString = "<div class='msgBoxLeft";
	                //$("#chatList > div").append("<div class='msgBoxLeft'><p>" + msg + "</p></div>");
	            }
	            
	            //Apply emotion to the message
	            switch(emotion){
	                
	                case 'joy':
	                    messageString = messageString + " emotionJoy'><p>" + msg + "</p></div>";
	                    break;
	                case 'anger':
	                    messageString = messageString + " emotionAnger'><p>" + msg + "</p></div>";
	                    break;
                    case 'sad':
                        messageString = messageString + " emotionSad'><p>" + msg + "</p></div>";
                        break;
                    case 'disgust':
                        messageString = messageString + " emotionDisgust'><p>" + msg + "</p></div>";
                        break;
                    case 'fear':
                        messageString = messageString + " emotionFear'><p>" + msg + "</p></div>";
                        break;
                    default:
                        messageString = messageString + " emotionNone'><p>" + msg + "</p></div>";
                        break;
	            }
	            
	            //Append the message to the screen
	            $("#chatList > div").append(messageString);
	            
	            //If the chat is finished loading, scroll to the bottom of the screen
	            if(chatLoaded)
	            {
	                $("#chatList > .ons-scroller__content").animate({ scrollTop: $("#chatList > .ons-scroller__content")[0].scrollHeight});    
	            }
	        }
	        
	        /*
	        *   Code From: http://stackoverflow.com/questions/24816/escaping-html-strings-with-jquery
	        */
	        
	        function escapeHtml(text) {
                'use strict';
                return text.replace(/[\"&<>]/g, function (a) {
                    return { '"': '&quot;', '&': '&amp;', '<': '&lt;', '>': '&gt;' }[a];
                });
            }
	    </script>
	    
	    <!-- Stylesheet for message boxes -->
	    <style>
	        /* Left and Right message boxes */
	        .msgBoxLeft{
	            width:60%;
	            float:left;
	            margin-left:10px;
	        }
	        
	        .msgBoxLeft > p{
	            float:left;
	            color:white;
	            /*background-color:#3498db;*/
	            padding:5px;
	            max-width:60%;
	            word-wrap:break-word;
	        }
	        
	        .msgBoxRight{
	            width:60%;
	            float:right;
	            margin-right:10px;
	        }
	        
	        .msgBoxRight > p{
	            float:right;
	            color:white;
	            /*background-color:#9b59b6;*/
	            padding:5px;
	            max-width:60%;
	            word-wrap:break-word;
	        }
	        
	        /* Basic Emotion CSS */
	        .emotionNone > p{
	            background-color: #34495e;
	        }
	        
            .emotionJoy > p{
	           background-color: #F1C40F;
	        }
	        
	        .emotionSad > p{
	            background-color: #2980B9;
	        }
	        
	        .emotionAnger > p{
	            text-align: center;
	            background-color:none;
	            max-width: 90%;
	            float:left;
	            padding: 20px;
	            margin: auto;
	        }
	        
	        .emotionFear > p{
	            background-color: #9B59B6;
	        }
	        
	        .emotionDisgust  > p{
	            text-align: center;
	            background-color: none;
	            max-width: 80%;
	            float: left;
	            padding: 20px;
	            margin: auto;
	            
	        }
            /* Custom Emotion CSS */
            
            .emotionDisgust{
                max-width: 60%;
                min-height: 23%;
                display: block;
                background-position: center; 
                background-repeat: no-repeat; 
                background-size:  cover;
                background-color: none;
                background-image: url("images/disgust.svg");
                margin: 5px;
                padding: 20px;
                
            }
            
            .emotionAnger{
                max-width: 60%;
                min-height: 15%;
                background-color: #E74C3C;
                background-size: cover;
                padding-left: 30px;
                padding-right: 30px;
                -webkit-clip-path:  polygon(99% 0%, 86% 13%, 83% 0, 65% 3%, 57% 11%, 46% 0, 36% 11%, 25% 0, 19% 9%, 3% 1%, 9% 18%, 0 27%, 8% 38%, 0 52%, 9% 59%, 0 70%, 6% 77%, 3% 95%, 16% 89%, 28% 100%, 40% 89%, 53% 99%, 64% 89%, 75% 100%, 83% 90%, 100% 95%, 94% 81%, 100% 64%, 93% 46%, 100% 34%, 95% 23%);
                clip-path:  polygon(99% 0%, 86% 13%, 83% 0, 65% 3%, 57% 11%, 46% 0, 36% 11%, 25% 0, 19% 9%, 3% 1%, 9% 18%, 0 27%, 8% 38%, 0 52%, 9% 59%, 0 70%, 6% 77%, 3% 95%, 16% 89%, 28% 100%, 40% 89%, 53% 99%, 64% 89%, 75% 100%, 83% 90%, 100% 95%, 94% 81%, 100% 64%, 93% 46%, 100% 34%, 95% 23%);
                -webkit-animation: clips 1s ease infinite;
                 animation: clips 1s ease infinite;
            }

            @-webkit-keyframes clips {
                 50% {
                -webkit-clip-path:  polygon(96% 8%, 93% 0, 82% 9%, 70% 2%, 57% 7%, 45% 6%, 33% 0, 26% 9%, 16% 0, 13% 11%, 1% 11%, 9% 24%, 1% 32%, 10% 46%, 0 53%, 11% 64%, 0 73%, 9% 84%, 6% 98%, 24% 91%, 37% 98%, 49% 93%, 60% 98%, 68% 91%, 83% 99%, 90% 89%, 100% 86%, 96% 67%, 100% 53%, 94% 37%, 100% 20%);
                clip-path:  polygon(96% 8%, 93% 0, 82% 9%, 70% 2%, 57% 7%, 45% 6%, 33% 0, 26% 9%, 16% 0, 13% 11%, 1% 11%, 9% 24%, 1% 32%, 10% 46%, 0 53%, 11% 64%, 0 73%, 9% 84%, 6% 98%, 24% 91%, 37% 98%, 49% 93%, 60% 98%, 68% 91%, 83% 99%, 90% 89%, 100% 86%, 96% 67%, 100% 53%, 94% 37%, 100% 20%);
                }
            }

            @keyframes clips {
                  50% {
                -webkit-clip-path:  polygon(96% 8%, 93% 0, 82% 9%, 70% 2%, 57% 7%, 45% 6%, 33% 0, 26% 9%, 16% 0, 13% 11%, 1% 11%, 9% 24%, 1% 32%, 10% 46%, 0 53%, 11% 64%, 0 73%, 9% 84%, 6% 98%, 24% 91%, 37% 98%, 49% 93%, 60% 98%, 68% 91%, 83% 99%, 90% 89%, 100% 86%, 96% 67%, 100% 53%, 94% 37%, 100% 20%);
                 clip-path:  polygon(96% 8%, 93% 0, 82% 9%, 70% 2%, 57% 7%, 45% 6%, 33% 0, 26% 9%, 16% 0, 13% 11%, 1% 11%, 9% 24%, 1% 32%, 10% 46%, 0 53%, 11% 64%, 0 73%, 9% 84%, 6% 98%, 24% 91%, 37% 98%, 49% 93%, 60% 98%, 68% 91%, 83% 99%, 90% 89%, 100% 86%, 96% 67%, 100% 53%, 94% 37%, 100% 20%);
                  }
            }
	    
	        /*
	        @keyframes pulse {
                  0% {
                        background-color: #001F3F;
                      }
                  100% {
                       background-color: #FF4136;
                    }
            }
            
            animation: pulse 5s infinite;
            */
            
            /*
	        .msgBoxLeft{
	            width: 100%;
                height: 100%;
                background: red;
                position: relative;
                -moz-border-radius:    10px;
                -webkit-border-radius: 10px;
                border-radius:         10px;

	        }
	        */
	    </style>
	</head>
	
	<body ng-controller="AppController">
		
		<!-- Other templates -->
        
        <ons-template id="menu.html">
            <p style="margin-left:5px;">Hi there,<br><b id="username_replace">TEST USERNAME</b></p>
            <ons-list>
                <ons-list-item modifier="chevron" ng-click="menu.setMainPage('main.html', {closeMenu: true});">
                    Conversations
                </ons-list-item>
                <!-- CUT UNTIL DELETE PROFILE/CHANGE PASSWORD IMPLEMENTED
                <ons-list-item modifier="chevron" ng-click="menu.setMainPage('profile.html', {closeMenu: true})">
                    Profile
                </ons-list-item>
                -->
                <ons-list-item modifier="chevron" onclick="logoutPrompt()">
                    Logout
                </ons-list-item>
            </ons-list>
        </ons-template>
		
		<!-- App Structure Code Start -->

        <ons-sliding-menu main-page="start.html" menu-page="menu.html" side="left" type="push" max-slide-distance="250px" var="menu" swipeable=false></ons-sliding-menu>
        
        <!-- Standard start code -->
        <ons-template id="start.html">
            <ons-navigator title="Navigator" var="tinglrNav" page="splash.html"></ons-navigator>
        </ons-template>
        
        <!-- TEST -->
        <!--<ons-template id="start.html">-->
        <!--    <ons-navigator title="Navigator" var="tinglrNav" page="landingscreen.html"></ons-navigator>-->
        <!--</ons-template>-->
        
        <!-- Splash Screen for server init -->
        <ons-template id="splash.html">
            <ons-page style="background: url('images/mainscreenbg.png'); background-position:center; background-repeat:no-repeat; background-size:cover;">
                <div style="text-align:center; margin-top:50%;">
                    <h4 style="color:white;">Starting Tinglr...</h4> 
                    <i class="fa fa-circle-o-notch fa-spin" style="font-size:24px; color:white;"></i>
                </div>
            </ons-page>
        </ons-template>
        
        <ons-template id="landingscreen.html">
            <ons-page style="background: url('images/mainscreenbg.png'); background-position:center; background-repeat:no-repeat; background-size:cover;">
                <div style="text-align:center;">
                    <div class="fitlogo">
                        <img src="images/Tinglr_logo.png"></img>
                    </div>
                    <div class="container">
                    <!--<h1 id="fittext1">Tinglr Messenger</h1>-->
                    </div>
                    <h3 style="color:white;">Messenger App</h3>
                    <ons-bottom-toolbar style="height: 130px; background: transparent; border: none;">
                        <div style="text-align: center" class="content-padded">
                            <ons-button class="button--large" ng-click="tinglrNav.pushPage('login.html', {animation : 'lift'})">Login</ons-button>
                            <br>
                            <ons-button class="button--large" ng-click="tinglrNav.pushPage('register.html', {animation : 'lift'})">Register</ons-button>
                        </div>
                    </ons-bottom-toolbar>
                </div>    
            </ons-page>
        </ons-template>
        
        <ons-template id="connection_server_offline.html">
            <ons-page ng-controller="PageController" style="background: url('images/mainscreenbg.png'); background-position:center; background-repeat:no-repeat; background-size:cover;">
                <div style="text-align:center; margin-top:50%;">
                    <h4 style="color:white;">Error Connecting to Server!</h4> 
                    <h4 style="color:white;">Attempting to Reconnect...</h4> 
                    <i class="fa fa-circle-o-notch fa-spin" style="font-size:24px; color:white;"></i>
                </div>
            </ons-page>
        </ons-template>
        
        <ons-template id="connection_error.html">
            <ons-page ng-controller="PageController" style="background: url('images/mainscreenbg.png'); background-position:center; background-repeat:no-repeat; background-size:cover;">
                <div style="text-align:center; margin-top:50%;">
                    <h4 style="color:white;">Error Connecting to Server!</h4> 
                    <h4 style="color:white;">Attempting to Reconnect...</h4> 
                    <i class="fa fa-circle-o-notch fa-spin" style="font-size:24px; color:white;"></i>
                </div>
            </ons-page>
        </ons-template>
        
        <ons-template id="fatal_error.html">
            <ons-page ng-controller="PageController" style="background: linear-gradient(150deg, rgb(52, 73, 94), rgb(49, 66, 102)); background-position:center; background-repeat:no-repeat; background-size:cover;">
                <div style="text-align:center; margin-top:50%;">
                    <i class="fa fa-exclamation-triangle" style="font-size:50px; color:rgb(241, 196, 15);"></i>
                    <h4 style="color:white;">FATAL ERROR</h4> 
                    <h4 style="color:white;">Please close the app and restart it to return to normal operation.</h4>
                </div>
            </ons-page>
        </ons-template>
        
        <ons-template id="login.html">
            <ons-page ng-controller="PageController">
                <ons-toolbar>
					<div class="left">
						<ons-toolbar-button ng-click="tinglrNav.popPage('landingscreen.html', {animation : 'fade'})">
				          <ons-icon icon="fa fa-chevron-circle-left"></ons-icon>
				        </ons-toolbar-button>
					</div>
					<div class="center">Login</div>
				</ons-toolbar>
                <div style="text-align:center;">
                    <p><b>Welcome Back! :)</b></p>
                    <input ng-model="loginUsername" type="text" class="text-input text-input--underbar" style="width:80%; margin-top:4px;" placeholder="Username">
                    <input ng-model="loginPassword" type="password" class="text-input text-input--underbar" style="width:80%; margin-top:4px;padding-top:4px;padding-bottom:0px;margin-top:25px;" placeholder="Password">
                    <ons-bottom-toolbar style="height: 65px; background: transparent; border: none;">
                        <div style="text-align: center" class="content-padded">
                            <ons-button class="button--large" ng-click="login(loginUsername, loginPassword);">Login</ons-button>            
                        </div>
                    </ons-bottom-toolbar>
                </div>
            </ons-page>
        </ons-template>
        
        <ons-template id="register.html">
            <ons-page ng-controller="PageController">
                <ons-toolbar>
					<div class="left">
						<ons-toolbar-button ng-click="tinglrNav.popPage('landingscreen.html', {animation : 'fade'})">
				          <ons-icon icon="fa fa-chevron-circle-left"></ons-icon>
				        </ons-toolbar-button>
					</div>
					<div class="center">Register</div>
				</ons-toolbar>
                <div style="text-align:center;">
                    <p><b>Welcome to Tinglr :)</b></p>
                    <input ng-model="registerUsername" type="text" class="text-input text-input--underbar" style="width:80%; margin-top:4px;" placeholder="Username">
                    <input ng-model="registerPasswordOne" type="password" class="text-input text-input--underbar" style="width:80%; margin-top:4px;padding-top:4px;padding-bottom:0px;margin-top:25px;" placeholder="Password">
                    <input ng_model="registerPasswordTwo" type="password" class="text-input text-input--underbar" style="width:80%; margin-top:4px;padding-top:4px;padding-bottom:0px;margin-top:25px;" placeholder="Confirm Password">
                        <!--<div class="register-form">
                            <input type="text" class="text-input--underbar" placeholder="First Name" value="">
                            <input type="text" class="text-input--underbar" placeholder="Surname" value="">
                            <input type="date" class="text-input--underbar" placeholder="Date of birth" value="">
                            <input type="text" class="text-input--underbar" placeholder="User Name" value="">
                            <input type="email" class="text-input--underbar" placeholder="Email" value="">
                            <input type="password" class="text-input--underbar" placeholder="Password" value="">
                            <input type="password" class="text-input--underbar" placeholder="Confirm Password" value="">
                        </div>-->
                        </ons-bottom-toolbar>
                    <ons-bottom-toolbar style="height: 65px; background: transparent; border: none;">
                        <div style="text-align: center" class="content-padded">
                            <ons-button class="button--large" ng-click="register(registerUsername,registerPasswordOne,registerPasswordTwo);">Register</ons-button>            
                        </div>
                    </ons-bottom-toolbar>
                </div>
            </ons-page>
        </ons-template>
        
        <!-- Main Pages -->
        <ons-template id="main_start.html">
            <ons-page ng-controller="PageController" ng-init="populateMain();">
            	<ons-toolbar>
					<div class="left">
						<ons-toolbar-button ng-click="menu.toggleMenu()">
				          <ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>
				        </ons-toolbar-button>
					</div>
					<div class="center">Conversations</div>
					<div class="right">
					    <ons-toolbar-button ng-click="tinglrNav.pushPage('search.html', {animation : 'fade'})">
					        <ons-icon icon="fa fa-search"></ons-icon>   
					    </ons-toolbar-button>
					</div>
				</ons-toolbar>
				<ons-scroller>
                    <ons-list id="connected_user_list">
                        <ons-list-header>Connected Friends</ons-list-header>
                        <ons-list-item modifier="chevron" ng-click="tinglrNav.pushPage('conversation.html', {animation : 'lift'})">Demo User</ons-list-item>
                    </ons-list>
                </ons-scroller>
            </ons-page>
        </ons-template>
        
        <ons-template id="main.html">
            <ons-navigator title="Navigator" var="tinglrNav" page="main_start.html"></ons-navigator>
        </ons-template>
        <!-- End of Main Page -->
        
        <ons-template id="profile.html">
            <ons-navigator title="Navigator" var="tinglrNav">
                <ons-page>
                	<ons-toolbar>
    					<div class="left">
    						<ons-toolbar-button ng-click="menu.toggleMenu()">
    				          <ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>
    				        </ons-toolbar-button>
    					</div>
    					<div class="center">Profile</div>
    					<!--<div class="right"></div>-->
    				</ons-toolbar>
                    <div style="text-align:center;">
                        <h3>Your Profile</h3>
                    </div>
                </ons-page>    
            </ons-navigator>
        </ons-template>
        
        <!--  Template to search for other user -->
        <ons-template id="search.html">
            <ons-page ng-controller="PageController">
            	<ons-toolbar>
					<div class="left">
						<ons-toolbar-button ng-click="tinglrNav.popPage('search.html', {animation : 'fade'}); populateMain();">
					        <ons-icon icon="fa fa-chevron-circle-left"></ons-icon>   
					    </ons-toolbar-button>
					</div>
					<div class="center">Search</div>
					<div class="right"></div>
				</ons-toolbar>
				<input ng-model="search_query" ng-change="searchOtherUsers(search_query);" type="search" class="search-input" placeholder="Search...">
				
				<ons-scroller style="height: calc(100% - 31px);">
                  <ons-list id="search_list">
                        <ons-list-item>No Results</ons-list-item>
                  </ons-list>
                </ons-scroller>
            </ons-page>
        </ons-template>
        
        <!-- Template for user's conversation -->
        <ons-template id="conversation.html">
            <ons-page ng-controller="PageController" ng-init="promptUser();">
                <ons-toolbar>
					<div class="left">
						<ons-toolbar-button onclick="setEmotion('none');" ng-click="tinglrNav.popPage('search.html', {animation : 'fade'}); populateMain();">
					        <ons-icon icon="fa fa-chevron-circle-left"></ons-icon>   
					    </ons-toolbar-button>
					</div>
					<div id="other_username" class="center"></div>
					<div class="right"></div>
				</ons-toolbar>
			    <ons-scroller class="chatarea" id="chatList" style="background: url('images/mainscreenbg.png'); background-position:center; background-repeat:no-repeat; background-size:cover;max-height: calc(100% - 115px);">
			        <svg version="1.1" id="Layer_1" style="display:none;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="50%" height="25%" viewBox="0 0 334.783 178.261" enable-background="new 0 0 334.783 178.261"
	 xml:space="preserve">
<g>
	<path fill="#79AF38" d="M316.063,147.42c0,3.313-6.699,3.977-8.871,6.148c-2.172,2.171-2.835-2.321-6.148-2.321
		c-4.533,0-4.533,6.549-9.065,6.549c-4.533,0-4.533-2.207-9.066-2.207c-4.532,0-4.532-3.079-9.065-3.079s-4.533,3.659-9.066,3.659
		s-4.533-4.71-9.066-4.71s-4.533,1.178-9.066,1.178s-4.533,6.046-9.065,6.046c-4.53,0-4.53-7.616-9.062-7.616
		c-4.533,0-4.533,11.625-9.065,11.625c-4.531,0-4.531,1.762-9.063,1.762c-4.532,0-4.532-11.336-9.065-11.336
		c-4.532,0-4.532-1.944-9.064-1.944c-4.533,0-4.533,6.531-9.066,6.531s-4.533,7.74-9.065,7.74c-4.533,0-4.533-7.88-9.066-7.88
		c-4.534,0-4.534,8.375-9.069,8.375c-4.534,0-4.534,0.438-9.067,0.438s-4.534-12.101-9.067-12.101c-4.534,0-4.534-1.119-9.068-1.119
		c-4.535,0-4.535,9.626-9.07,9.626c-4.534,0-4.534-5.219-9.068-5.219c-4.534,0-4.534-2.785-9.067-2.785
		c-4.534,0-4.534,1.319-9.067,1.319s-4.534-1.854-9.067-1.854c-4.535,0-4.535,2.862-9.07,2.862c-4.537,0-4.537-1.691-9.073-1.691
		c-4.535,0-4.535,1.026-9.07,1.026c-4.538,0-4.538-3.516-9.076-3.516s-4.538,8.476-9.076,8.476c-3.314,0-11.295,1.656-13.467-0.516
		c-2.171-2.172-4.97-10.153-4.97-13.466c0-4.614,5.352-4.614,5.352-9.229c0-4.615-5.114-4.615-5.114-9.23
		c0-4.616,13.324-4.616,13.324-9.232c0-4.615-11.721-4.615-11.721-9.23s4.944-4.615,4.944-9.229s6.933-4.614,6.933-9.229
		s-3.476-4.615-3.476-9.229c0-4.616,0.574-4.616,0.574-9.232c0-4.617-12.696-4.617-12.696-9.234c0-4.616,16.081-4.616,16.081-9.232
		c0-4.619-12.777-4.619-12.777-9.238c0-4.619,6.36-4.619,6.36-9.238c0-3.314-0.831-7.141,1.341-9.312s5.998,3.07,9.312,3.07
		c4.533,0,4.533-5.5,9.065-5.5c4.534,0,4.534,5.139,9.067,5.139c4.533,0,4.533-13.194,9.065-13.194c4.533,0,4.533,16.28,9.066,16.28
		s4.533-15.147,9.066-15.147s4.533,9.17,9.066,9.17s4.533-5.572,9.065-5.572c4.531,0,4.531-1.144,9.061-1.144
		c4.533,0,4.533,11.646,9.066,11.646c4.532,0,4.532-4.417,9.063-4.417c4.532,0,4.532,3.522,9.065,3.522
		c4.532,0,4.532-13.106,9.064-13.106c4.534,0,4.534,11.627,9.067,11.627c4.532,0,4.532,2.844,9.064,2.844
		c4.534,0,4.534-0.64,9.067-0.64c4.534,0,4.534-5.147,9.068-5.147c4.533,0,4.533,2.446,9.067,2.446s4.534-5.106,9.067-5.106
		c4.534,0,4.534-0.982,9.068-0.982c4.535,0,4.535-1.494,9.07-1.494c4.534,0,4.534,3.188,9.068,3.188
		c4.533,0,4.533-5.532,9.067-5.532c4.533,0,4.533,11.802,9.066,11.802c4.534,0,4.534-9.424,9.067-9.424
		c4.535,0,4.535-1.358,9.07-1.358c4.536,0,4.536,5.62,9.072,5.62c4.535,0,4.535-7.187,9.07-7.187c4.538,0,4.538,11.742,9.076,11.742
		s4.538-7.527,9.076-7.527c3.313,0,5.313,4.036,7.485,6.208c2.172,2.172-3.937,4.172-3.937,7.485c0,4.615,12.986,4.615,12.986,9.229
		c0,4.615-5.113,4.615-5.113,9.23c0,4.616-7.99,4.616-7.99,9.232c0,4.615,5.149,4.615,5.149,9.23c0,4.614,10.545,4.614,10.545,9.229
		s-9.908,4.615-9.908,9.229s6.644,4.614,6.644,9.229c0,4.616-10.633,4.616-10.633,9.231c0,4.618,13.566,4.618,13.566,9.235
		c0,4.616-7.68,4.616-7.68,9.232c0,4.619-2.015,5.143-1.031,9.655C312.174,143.405,316.063,142.801,316.063,147.42z"/>
</g>
</svg>
			    </ons-scroller>
			    <div id="messageInput" style="border-top:solid rgb(48, 120, 197);height:50px;">
			        <div id="emoteBar" class="button-bar" style="width:100%;margin-top:2px;margin-bottom:2px;">
                        <div id="disgustBtn" class="button-bar__item">
                            <button onclick="setEmotion('disgust');" style="border:0;height:50px;" class="button-bar__button"><img src="images/disgust_green.png"></button>
                        </div>
                        
                        <div id="fearBtn" class="button-bar__item">
                            <button onclick="setEmotion('fear');" style="border:0;height:50px;" class="button-bar__button"><img src="images/fear_purple.png"></button>
                        </div>
                        
						<div id="sadBtn" class="button-bar__item">
                            <button onclick="setEmotion('sad');" style="border:0;height:50px;" class="button-bar__button"><img src="images/sad_blue.png"></button>
                        </div>
                        
                        <div id="angerBtn" class="button-bar__item">
                            <button onclick="setEmotion('anger');" style="border:0;height:50px;" class="button-bar__button"><img src="images/anger_red.png"></button>
                        </div>
                        
                        <div id="joyBtn" class="button-bar__item">
                            <button onclick="setEmotion('joy');" style="border:0;height:50px;" class="button-bar__button"><img src="images/joy_yellow.png"></button>
                        </div>
                    </div>
			        
			        <textarea ng-model="inputMSG" class="textarea" style="float:left;height:50px;margin:0;width: calc(100% - 55px); margin-left:5px; background-color:white;" placeholder="Write a Tingle..."></textarea>
                    <button id="sendButton" ng-click="send(inputMSG)" style="float:left;width:50px;height:50px;background:none;margin:0;padding:0;border:0;">
                        <ons-icon
                            icon="fa-envelope"
                            size="35px"
                            fixed-width="false"
                            style="color: rgb(48, 120, 197)">
                        </ons-icon>
                    </button>      
			    </div>
                
            </ons-page>
        </ons-template>
		<!-- App Structure Code End -->
		
		<!-- Modals to display errors -->
		
		<!-- Connection Error Modal -->
		<ons-modal var="connection_modal">
            <br> Error Connecting to Server!
            <br> Attempting to reconnect...
            <br>
            <br>
            <ons-icon icon="ion-load-c" spin="true"></ons-icon>
        </ons-modal>
        
        <!-- Logging in modal -->
		<ons-modal var="login_attempt_modal">
            <br> Logging in
            <br> Please wait...
            <br>
            <br>
            <ons-icon icon="ion-load-c" spin="true"></ons-icon>
        </ons-modal>
        
        <!-- Login failed modal -->
		<ons-modal var="login_failed_modal">
            <br> Login Failed
            <br>
            <br> Please make sure your
            <br> username and password is correct!
            <br>
            <br>
            <ons-button class="button--small" ng-click="login_failed_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Login failed duplicate modal -->
		<ons-modal var="login_failed_duplicate_modal">
            <br> Login Failed
            <br>
            <br> This account is already logged in
            <br> on another device. Try again later!
            <br>
            <br>
            <ons-button class="button--small" ng-click="login_failed_duplicate_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Login failed blank username -->
		<ons-modal var="login_failed_username_blank_modal">
            <br> Login Failed
            <br>
            <br> Please don't leave the
            <br> username field blank.
            <br>
            <br>
            <ons-button class="button--small" ng-click="login_failed_username_blank_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Login failed blank password -->
		<ons-modal var="login_failed_password_blank_modal">
            <br> Login Failed
            <br>
            <br> Please don't leave the
            <br> password field blank.
            <br>
            <br>
            <ons-button class="button--small" ng-click="login_failed_password_blank_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Login failed illegal characters -->
		<ons-modal var="login_failed_illegals_modal">
            <br> Login Failed
            <br>
            <br> Only use alphanumeric characters
            <br> in your username and password.
            <br>
            <br>
            <ons-button class="button--small" ng-click="login_failed_illegals_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Register attempt modal -->
		<ons-modal var="register_attempt_modal">
            <br> Attempting Registration
            <br>
            <br> Please wait...
            <br>
            <br>
            <ons-icon icon="ion-load-c" spin="true"></ons-icon>
        </ons-modal>
        
        <!-- Register password mismatch modal -->
		<ons-modal var="register_failed_password_miss_modal">
            <br> Registration Failed
            <br>
            <br> Please make sure your password 
            <br> is the same in both boxes.
            <br>
            <br>
            <ons-button class="button--small" ng-click="register_failed_password_miss_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Register blank username modal -->
		<ons-modal var="register_failed_username_blank_modal">
            <br> Registration Failed
            <br>
            <br> Please fill in your username into
            <br> the username input field.
            <br>
            <br>
            <ons-button class="button--small" ng-click="register_failed_username_blank_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Register short username modal -->
		<ons-modal var="register_failed_username_length_modal">
            <br> Registration Failed
            <br>
            <br> Please ensure that your username
            <br> is at least 4 characters long.
            <br>
            <br>
            <ons-button class="button--small" ng-click="register_failed_username_length_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Register blank password modal -->
		<ons-modal var="register_failed_password_blank_modal">
            <br> Registration Failed
            <br>
            <br> Please fill in your password into
            <br> the password input fields.
            <br>
            <br>
            <ons-button class="button--small" ng-click="register_failed_password_blank_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Register short password modal -->
		<ons-modal var="register_failed_password_length_modal">
            <br> Registration Failed
            <br>
            <br> Please ensure that your password
            <br> is at least 6 characters long.
            <br>
            <br>
            <ons-button class="button--small" ng-click="register_failed_password_length_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Register attempt modal -->
		<ons-modal var="register_failed_duplicate_modal">
            <br> Registration Failed
            <br>
            <br> A user already exists with this username.
            <br> Please choose a different one.
            <br>
            <br>
            <ons-button class="button--small" ng-click="register_failed_duplicate_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Register illegal characters modal -->
		<ons-modal var="register_failed_illegals_modal">
            <br> Registration Failed
            <br>
            <br> Only use alphanumeric characters
            <br> in your username and password.
            <br>
            <br>
            <ons-button class="button--small" ng-click="register_failed_illegals_modal.hide()">Okay</ons-button>
        </ons-modal>
        
        <!-- Fatal error modal -->
		<ons-modal var="fatal_error_modal">
            <br> FATAL ERROR
            <br>
            <br> Please close the app and restart it
            <br> to return to normal operation.
        </ons-modal>
	</body>
</html>
